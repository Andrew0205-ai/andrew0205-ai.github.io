<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>開發者面板 vFinal</title>
<style>
:root { --main-color:#6200ea; --bg-color:#f3f3f3; --text-color:#222; }
body { font-family: system-ui; background: var(--bg-color); color: var(--text-color); margin:0; padding:20px; }
h1 { text-align:center; margin-bottom:20px; }
.card { background:white; padding:16px; margin-bottom:20px; border-radius:12px; box-shadow:0 3px 8px rgba(0,0,0,0.15);}
.card h2 { margin-top:0; }
button { padding:8px 12px; border:none; border-radius:6px; cursor:pointer; background:var(--main-color); color:white; }
button:hover { opacity:0.85; }
#dev-panel { position:fixed; right:20px; bottom:20px; width:350px; max-height:90%; overflow:auto; background:rgba(0,0,0,0.7); color:white; padding:20px; border-radius:20px; display:none; z-index:9999; }
#closeDev { background:#b00020; }
textarea { width:100%; height:80px; }
</style>
</head>
<body>

<h1>開發者面板 vFinal</h1>

<div id="dev-panel">
  <button id="closeDev">關閉面板</button>

  <div class="card">
    <h2>系統配色</h2>
    <input type="color" id="colorPicker" value="#6200ea">
    <button id="applyColor">套用顏色</button>
  </div>

  <div class="card">
    <h2>Blogger</h2>
    <p>文章數：<span id="blog-count">抓取中...</span></p>
    <div id="posts">載入中...</div>
    <button id="reloadPosts">重新抓取</button>
  </div>

  <div class="card">
    <h2>留言板監控</h2>
    <button id="loadComments">載入留言</button>
    <pre id="commentOutput"></pre>
  </div>

  <div class="card">
    <h2>更新紀錄</h2>
    <textarea id="update-log"></textarea>
    <button id="saveUpdate">儲存</button>
  </div>

  <div class="card">
    <h2>工具區</h2>
    <button id="openColorTool">開啟：顏色查詢器</button>
  </div>

  <div class="card">
    <h2>API Key</h2>
    <form onsubmit="return false;">
      <input type="password" id="apiKey" placeholder="輸入 API Key" autocomplete="new-password">
      <button id="toggleApi">顯示 / 隱藏</button>
    </form>
  </div>
</div>

<!-- Firebase 8 非模組版 CDN -->
<script src="https://www.gstatic.com/firebasejs/8.16.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.16.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.16.0/firebase-firestore.js"></script>

<script>
window.addEventListener("DOMContentLoaded", () => {

  // ===== Firebase 初始化 =====
  const firebaseConfig = {
    apiKey: "AIzaSyClktI5_wSo-u9LuwdsBVzH6buizJPXMAs",
    authDomain: "mycomment-ad1ba.firebaseapp.com",
    projectId: "mycomment-ad1ba",
    storageBucket: "mycomment-ad1ba.appspot.com",
    messagingSenderId: "1076313273646",
    appId: "1:1076313273646:web:2b5aaa8c6bd5824828f6bf",
    measurementId: "G-3NGHCWH7TP"
  };
  firebase.initializeApp(firebaseConfig);

  // ===== Dev Panel 顯示 / 關閉 =====
  document.addEventListener("keydown", e => { if(e.key==="F12") document.getElementById("dev-panel").style.display="block"; });
  document.getElementById("closeDev").onclick = () => { document.getElementById("dev-panel").style.display="none"; };

  // ===== 系統顏色 =====
  document.getElementById("applyColor").onclick = () => {
    const color = document.getElementById("colorPicker").value;
    document.documentElement.style.setProperty("--main-color", color);
    alert("顏色已套用！");
  };

  // ===== Blogger API =====
  const BLOG_ID = "8801793508864739730";
  const API_KEY = "AIzaSyBKmIaMltKWERD1-ZX47ed2IpsRGzc1HXU";

  async function loadPosts(max=5){
    document.getElementById("posts").innerText="抓取中...";
    document.getElementById("blog-count").innerText="抓取中...";
    try {
      let res = await fetch(`https://www.googleapis.com/blogger/v3/blogs/${BLOG_ID}/posts?key=${API_KEY}&maxResults=${max}`);
      let data = await res.json();
      const list = data.items.map(p=>`• ${p.title}`).join("\n");
      document.getElementById("posts").innerText = list;
      let countRes = await fetch(`https://www.googleapis.com/blogger/v3/blogs/${BLOG_ID}?key=${API_KEY}`);
      let countData = await countRes.json();
      document.getElementById("blog-count").innerText = countData.posts.totalItems;
    } catch(e){ console.error(e); document.getElementById("posts").innerText="抓取失敗"; document.getElementById("blog-count").innerText="錯誤"; }
  }
  loadPosts();
  document.getElementById("reloadPosts").onclick = () => loadPosts();

  // ===== Firebase 留言監控 =====
  document.getElementById("loadComments").onclick = async () => {
    const output=document.getElementById("commentOutput");
    output.innerText="載入中...";
    try {
      const snapshot = await firebase.firestore().collection("comments").get();
      let text="";
      snapshot.forEach(doc=>{ text += JSON.stringify(doc.data(),null,2)+"\n\n"; });
      output.innerText=text;
    } catch(e){ output.innerText="抓取失敗"; console.error(e);}
  };

  // ===== 更新紀錄 =====
  document.getElementById("saveUpdate").onclick = () => {
    const text=document.getElementById("update-log").value;
    localStorage.setItem("devUpdateLog",text);
    alert("已儲存！");
  };
  const saved=localStorage.getItem("devUpdateLog");
  if(saved) document.getElementById("update-log").value=saved;

  // ===== 工具區 =====
  document.getElementById("openColorTool").onclick = () => window.location.href="color.html";

  // ===== API Key 隱藏切換 =====
  document.getElementById("toggleApi").onclick = () => {
    const api=document.getElementById("apiKey");
    api.type = api.type==="password"?"text":"password";
  };

});
</script>

</body>
</html>
